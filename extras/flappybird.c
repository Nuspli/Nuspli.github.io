#include<stdio.h>
#include<string.h>
#include<windows.h>
#include<time.h>
#include<conio.h>
#include<stdlib.h>

#define SCREENWIDTH 140
#define SCREENHEIGHT 50
#define PIPEOFFSET 24

char backgroundBuffer[SCREENHEIGHT][SCREENWIDTH];
char pipeBuffer[SCREENHEIGHT][SCREENWIDTH + 2*PIPEOFFSET];
char birdBuffer[SCREENHEIGHT][SCREENWIDTH];
char screenBuffer[SCREENHEIGHT][SCREENWIDTH + 1];
char previousScreen[SCREENHEIGHT][SCREENWIDTH];

int score = 0;
HANDLE consoleHandle;

char background[50][141] = {

    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "      CCCBCDDD    QQQQOOOOODDDDDDD                                          iiiii    iiiiiiiiiiiiiiiiii                                     ",
    "        ccc     OOOOOOO  DDDDDDDDDDDD                                    CCCOOOOOOOOOOOOOOOOOOoooooooooooo                                  ",
    "                         ^^^^^^^^^^                                             ^^^^^^^^^^^^^^^^^^^^^^                                      ",
    "                                                                                                                                            ",
    "                       ooo                  v^   ^v                                                             DDDDDDDDDDD                 ",
    "                  QQoOoOoooo                  \\M/                                        ccccc                CCCCCCCCCCCCCCCC              ",
    "                    DDDddddDd                                                      QQQQQQQQQQQQQQQQ                  ^^^^^^^^               ",
    "                       ^^^^                                                      QQQQQQQQQQQQQQQQQQQQ                                       ",
    "                                                                                      ccccccccccc                                           ",
    "                                                                                                                                            ",
    "          _ ._  _ , _ ._                                                                                                                    ",
    "        (  ' ( `  )_  .  )                                                                                        ___________||____         ",
    "      ( (  (  )   `)    )  )                                                                                     /   oo            \\        ",
    "     (___(  (_   _) _  ) ,__)                                                       ...                         /___________________\\       ",
    "         `~~`\\ ' . /`~~`                                                           o(O)o                       /|            _ _    |\\      ",
    "              ;   ;                __,.,-,._ _                                      *|*                         |           |_|_|   |       ",
    "              /   \\             (   (* *)   ) \\                                     \\|/                         |          _        |       ",
    "_____________/     \\___________(  (   )   )   )______________________________________|__________________________|_________| |_______|________"

};

char pipePair[78][188] = {
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                       _||______________|_ ",
    "                                                                                                                                                                      ||................**|",
    "                                                                                                                                                                      ||__________________|",
    "                                                                                                                                                                                           ",
    "                                                                                                                                                                                           ",
    "                                                                                                                                                                                           ",
    "                                                                                                                                                                                           ",
    "                                                                                                                                                                                           ",
    "                                                                                                                                                                                           ",
    "                                                                                                                                                                                           ",
    "                                                                                                                                                                                           ",
    "                                                                                                                                                                       ___________________ ",
    "                                                                                                                                                                      ||................**|",
    "                                                                                                                                                                      ||__________________|",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  ",
    "                                                                                                                                                                        ||++++++++++++##|  "
};

#define TOPOFBIRD 17
#define BOTTOMOFBIRD 19

char bird[50][141] = {
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                              _^'`(Q                                                                        ",
    "                                                             {__} __G                                                                       ",
    "                                                              `''''                                                                         ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            "
};

char birdUp[50][141] = {
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                              '(Q\\+_                                                                        ",
    "                                                             { \\___G|                                                                       ",
    "                                                             \\_}+''                                                                         ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            "
};

char birdDown[50][141] = {
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                              -'`'*+_                                                                       ",
    "                                                             {_  } _Q                                                                       ",
    "                                                              `\\___G                                                                        ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            ",
    "                                                                                                                                            "
};

void set_text(int x, int y, char *text, int length) {
    for (int i = 0; i < length; i++) {
        screenBuffer[y][x + i] = text[i];
    }
}

void update_background() {
    
    for (int y = 0; y < SCREENHEIGHT; y++) {
        for (int x = 0; x < SCREENWIDTH; x++) {

            backgroundBuffer[y][x] = background[y][x];

            if (backgroundBuffer[y][x] != previousScreen[y][x]) {
                
                screenBuffer[y][x] = backgroundBuffer[y][x];
            }
        }
    }
}

void update_pipes() {
    
    for (int y = 0; y < SCREENHEIGHT; y++) {
        for (int x = 0; x < SCREENWIDTH; x++) {
            if (pipeBuffer[y][x + PIPEOFFSET] != ' ' && pipeBuffer[y][x + PIPEOFFSET] != 0) {
                
                screenBuffer[y][x] = pipeBuffer[y][x + PIPEOFFSET];
            }
        }
    }
}

void update_bird() {

    for (int y = 0; y < SCREENHEIGHT; y++) {
        for (int x = 0; x < SCREENWIDTH; x++) {
            if (birdBuffer[y][x] != ' ' ) {
                
                screenBuffer[y][x] = birdBuffer[y][x];
            }
        }
    }
}

void update_score() {
    
    char scoreText[32];
    sprintf(scoreText, "score: %d", score);
    int length = strlen(scoreText);

    for (int i = 0; i < length; i++) {
        screenBuffer[1][(SCREENWIDTH - length) / 2 + i] = scoreText[i];
    }
}

void update_screen_buffer() {


    for (int y = 0; y < SCREENHEIGHT; y++) {

        COORD pos = {0, y};
        SetConsoleCursorPosition(consoleHandle, pos);
        fprintf(stdout, "%s", screenBuffer[y]); // with printf there was some rare flickering for some reason

        for (int x = 0; x < SCREENWIDTH; x++) {
            previousScreen[y][x] = screenBuffer[y][x];
        }
    }

}

void update_screen() {

    update_background();
    update_pipes();
    update_bird();
    update_score();
    update_screen_buffer();
}

void clear_screen() {
    for (int y = 0; y < SCREENHEIGHT; y++) {
        for (int x = 0; x < SCREENWIDTH; x++) {
            backgroundBuffer[y][x] = ' ';
            birdBuffer[y][x] = ' ';
            screenBuffer[y][x] = ' ';
        }
    }

    for (int y = 0; y < SCREENHEIGHT; y++) {
        for (int x = 0; x < SCREENWIDTH + 2*PIPEOFFSET; x++) {
            pipeBuffer[y][x] = ' ';
        }
    }

    update_screen_buffer();
}

void init_console() {

    system("cls"); // clear console

    SMALL_RECT windowSize = {0, 0, SCREENWIDTH - 1, SCREENHEIGHT - 1};
    COORD bufferSize = {SCREENWIDTH, SCREENHEIGHT};

    SetConsoleWindowInfo(consoleHandle, 1, &windowSize);
    SetConsoleScreenBufferSize(consoleHandle, bufferSize);

    for (int y = 0; y < SCREENHEIGHT; y++) {
        for (int x = 0; x < SCREENWIDTH; x++) {
            backgroundBuffer[y][x] = ' ';
            birdBuffer[y][x] = ' ';
        }
    }
    for (int y = 0; y < SCREENHEIGHT; y++) {
        for (int x = 0; x < SCREENWIDTH + 2*PIPEOFFSET; x++) {
            pipeBuffer[y][x] = ' ';
        }
    }
}

void init_screen_buffers() {

    for (int y = 0; y < SCREENHEIGHT; y++) {
        screenBuffer[y][SCREENWIDTH] = '\0'; 
        for (int x = 0; x < SCREENWIDTH; x++) {
            backgroundBuffer[y][x] = background[y][x];
            birdBuffer[y][x] = bird[y][x];
        }
    }

    update_screen();
}

void game_over_screen() {

    char *text[] = {                                                                                       
                                                                                          
        "  /$$$$$$   /$$$$$$  /$$$$$$/$$$$   /$$$$$$         /$$$$$$  /$$    /$$ /$$$$$$   /$$$$$$ ",
        " /$$__  $$ |____  $$| $$_  $$_  $$ /$$__  $$       /$$__  $$|  $$  /$$//$$__  $$ /$$__  $$",
        "| $$  \\ $$  /$$$$$$$| $$ \\ $$ \\ $$| $$$$$$$$      | $$  \\ $$ \\  $$/$$/| $$$$$$$$| $$  \\__/",
        "| $$  | $$ /$$__  $$| $$ | $$ | $$| $$_____/      | $$  | $$  \\  $$$/ | $$_____/| $$      ",
        "|  $$$$$$$|  $$$$$$$| $$ | $$ | $$|  $$$$$$$      |  $$$$$$/   \\  $/  |  $$$$$$$| $$      ",
        " \\____  $$ \\_______/|__/ |__/ |__/ \\_______/       \\______/     \\_/    \\_______/|__/      ",
        " /$$  \\ $$                                                                                ",
        "|  $$$$$$/                                                                                ",
        " \\______/                                                                                 "
    };

    for (int i = 0; i < 9; i++) {
        set_text((SCREENWIDTH - 91) / 2, SCREENHEIGHT / 2 - 5 + i, text[i], 91);
    }

    char scoreText[32];
    sprintf(scoreText, "score: %d", score);
    set_text((SCREENWIDTH - strlen(scoreText)) / 2, SCREENHEIGHT / 2 + 5, scoreText, strlen(scoreText));

    update_screen_buffer();
    Sleep(500);
    getchar();
    system("cls");
}

void move_bird(int y, float birdMovement) {
    // all three bird buffers have to be moved together

    if (y > 0) {

        for (int i = 0; i < SCREENHEIGHT; i++) {
            for (int j = 0; j < SCREENWIDTH; j++) {
                if (i + y < SCREENHEIGHT) {
                    bird[i][j] = bird[i + y][j];
                    birdUp[i][j] = birdUp[i + y][j];
                    birdDown[i][j] = birdDown[i + y][j];
                } else {
                    bird[i][j] = ' ';
                    birdUp[i][j] = ' ';
                    birdDown[i][j] = ' ';
                }
            }
        }

        for (int i = 0; i < SCREENHEIGHT; i++) {
            for (int j = 0; j < SCREENWIDTH; j++) {
                birdBuffer[i][j] = birdUp[i][j];
            }
        }


    } else {
        for (int i = SCREENHEIGHT - 1; i >= 0; i--) {
            for (int j = 0; j < SCREENWIDTH; j++) {
                if (i + y >= 0) {
                    bird[i][j] = bird[i + y][j];
                    birdUp[i][j] = birdUp[i + y][j];
                    birdDown[i][j] = birdDown[i + y][j];
                } else {
                    bird[i][j] = ' ';
                    birdUp[i][j] = ' ';
                    birdDown[i][j] = ' ';
                }
            }
        }

        if (birdMovement < -1.1) {
            for (int i = 0; i < SCREENHEIGHT; i++) {
                for (int j = 0; j < SCREENWIDTH; j++) {
                    birdBuffer[i][j] = birdDown[i][j];
                }
            }
            return;
        }

        for (int i = 0; i < SCREENHEIGHT; i++) {
            for (int j = 0; j < SCREENWIDTH; j++) {
                birdBuffer[i][j] = bird[i][j];
            }
        }
    }
}

void spawn_pipe_pair() {

    int pipeRan = rand() % 28;
    
    for (int i = 0; i < SCREENHEIGHT; i++) {
        for (int j = SCREENWIDTH + PIPEOFFSET; j < SCREENWIDTH + 2*PIPEOFFSET; j++) {
            pipeBuffer[i][j] = pipePair[i+pipeRan][j];
        }
    }
}

void move_pipe_pair(int *numPipes) {

    for (int i = 0; i < SCREENHEIGHT; i++) {
        for (int j = 0; j < SCREENWIDTH + 2*PIPEOFFSET; j++) {
            if (j + 1 < SCREENWIDTH + 2*PIPEOFFSET) {
                pipeBuffer[i][j] = pipeBuffer[i][j + 1];
            } else {
                pipeBuffer[i][j] = ' ';
            }
        }
    }

    if (pipeBuffer[0][0] == 0) {
        *numPipes = *numPipes - 1;
    }
}

void game_loop() {

    init_screen_buffers();

    int lost = 0;
    clock_t lastInput = clock();
    clock_t lastPipe = -3000;

    float multiplyer = 1.11;
    float birdMovement = -1.0;
    char ch;
    int birdYTOP = 17;
    int birdYBTM = 19;
    int birdXLFT = 61;
    int birdXRGT = 68;
    int numPipes = 0;

    while (!lost) {

        clock_t now = clock();

        if (numPipes < 3 && (now - lastPipe) >= 3000) {
            spawn_pipe_pair();
            lastPipe = now;
            numPipes++;
        }

        birdMovement = (float)(birdMovement * multiplyer);

        if (kbhit() && (now - lastInput) > 250) {
            ch = getch(); // this is needed to stop kbhit() from returning 1 on the next loop
            // move bird up
            lastInput = now;
            multiplyer = 0.6;
            birdMovement = 3.0;

        } else if ((now - lastInput) > 275 && birdMovement > 0) {
            // move bird down
            multiplyer = 1.11;
            birdMovement = -1.0;
        }

        move_pipe_pair(&numPipes);

        if (pipeBuffer[birdYTOP-1][birdXLFT + PIPEOFFSET] == 0) {
            score++;
        }

        update_screen();

        move_bird((int)(birdMovement), birdMovement);
        move_pipe_pair(&numPipes);
        // points
        if (pipeBuffer[birdYTOP-1][birdXLFT + PIPEOFFSET] == 0) {
            score++;
        }

        update_screen();

        birdYTOP -= (int)(birdMovement);
        birdYBTM -= (int)(birdMovement);

        // collision
        if (birdYTOP < 0 || birdYBTM > SCREENHEIGHT - 1 || 
            (pipeBuffer[birdYTOP][64 + PIPEOFFSET] != ' ' && pipeBuffer[birdYTOP][64 + PIPEOFFSET] != 0) || 
            (pipeBuffer[birdYBTM-1][64 + PIPEOFFSET] != ' ' && pipeBuffer[birdYBTM-1][64 + PIPEOFFSET] != 0) || 
            (pipeBuffer[birdYTOP][65 + PIPEOFFSET] != ' ' && pipeBuffer[birdYTOP][65 + PIPEOFFSET] != 0) || 
            (pipeBuffer[birdYBTM-1][65 + PIPEOFFSET] != ' ' && pipeBuffer[birdYBTM-1][65 + PIPEOFFSET] != 0) ||
            (pipeBuffer[birdYTOP-1][birdXLFT + PIPEOFFSET] != ' ' && pipeBuffer[birdYTOP-1][birdXLFT + PIPEOFFSET] != 0) ||
            (pipeBuffer[birdYTOP-1][birdXRGT + PIPEOFFSET] != ' ' && pipeBuffer[birdYTOP-1][birdXRGT + PIPEOFFSET] != 0)) {

            lost = 1;
            break;
        }

        Sleep(50);
    }

    clear_screen();
    game_over_screen();
}

int main() {

    srand(time(NULL));
    printf("initializing... please be patient...\n");
    consoleHandle = GetStdHandle(STD_OUTPUT_HANDLE);
    CONSOLE_CURSOR_INFO cursorInfo;
    GetConsoleCursorInfo(consoleHandle, &cursorInfo);
    cursorInfo.bVisible = FALSE;
    SetConsoleCursorInfo(consoleHandle, &cursorInfo);

    init_console();
    srand(time(NULL));
    printf("\nflappy bird clone by kolmus\npress enter to start\nto quit press ctr+c or run into a pipe\n");
    getchar();
    system("cls");

    game_loop();

    cursorInfo.bVisible = TRUE;
    SetConsoleCursorInfo(consoleHandle, &cursorInfo);
    CloseHandle(consoleHandle);

    return 0;
}